<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kalkulator Ongkir dengan Google Maps</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4">Kalkulator Ongkir</h1>

    <!-- Input Alamat -->
    <label class="block mb-2">Alamat Jemput</label>
    <input id="alamatJemput" type="text" class="w-full border p-2 mb-4 rounded" placeholder="Contoh: Jatibening, Bekasi" />
    
    <label class="block mb-2">Alamat Tujuan</label>
    <input id="alamatTujuan" type="text" class="w-full border p-2 mb-4 rounded" placeholder="Contoh: Tanah Abang, Jakarta" />

    <!-- Tombol Ambil Jarak dari Google -->
    <button onclick="ambilJarak()" class="w-full bg-yellow-500 text-white py-2 rounded mb-4">
      Ambil Jarak Otomatis dari Google
    </button>

    <!-- Dropdown Pilih Jarak -->
    <label class="block mb-2">Pilih Rute (tol / non-tol)</label>
    <select id="jarakSelector" class="w-full border p-2 rounded mb-4" onchange="updateJarak()">
      <option value="">-- Pilih rute otomatis --</option>
    </select>

    <label class="block mb-2">Jarak Pengiriman (km)</label>
    <input id="jarak" type="number" class="w-full border p-2 mb-4 rounded" placeholder="Masukkan jarak jika manual" />

    <!-- Pilih Kendaraan -->
    <label class="block mb-2">Jenis Kendaraan</label>
    <div class="flex space-x-4 mb-4">
      <button onclick="pilih('pickup')" id="btnPickup" class="px-4 py-2 border rounded bg-blue-100">Pick Up</button>
      <button onclick="pilih('van')" id="btnVan" class="px-4 py-2 border rounded">Van</button>
    </div>

    <label class="block mb-2">Biaya Tol (opsional)</label>
    <input id="tol" type="number" class="w-full border p-2 mb-4 rounded" placeholder="Masukkan biaya tol" />

    <label class="block mb-2">Jumlah Tujuan</label>
    <input id="tujuan" type="number" class="w-full border p-2 mb-4 rounded" value="1" />

    <div class="flex items-center space-x-2 my-4">
      <input type="checkbox" id="pp" />
      <label for="pp">Pulang Pergi?</label>
    </div>

    <div class="flex items-center space-x-2 mb-4">
      <input type="checkbox" id="helper" />
      <label for="helper">Butuh Helper? (+Rp75.000)</label>
    </div>

    <button onclick="hitung()" class="w-full bg-blue-600 text-white py-2 rounded">Hitung Ongkir</button>

    <div class="mt-6 space-y-4" id="hasil"></div>

    <div class="mt-4">
      <button onclick="salinWA()" class="bg-green-600 text-white px-4 py-2 rounded">Salin Estimasi ke Clipboard</button>
    </div>

    <textarea id="waText" class="hidden"></textarea>
  </div>

  <script>
    let kendaraan = 'pickup';

    function pilih(jenis) {
      kendaraan = jenis;
      document.getElementById('btnPickup').classList.remove('bg-blue-600', 'text-white');
      document.getElementById('btnVan').classList.remove('bg-blue-600', 'text-white');
      if (jenis === 'pickup') {
        document.getElementById('btnPickup').classList.add('bg-blue-600', 'text-white');
      } else {
        document.getElementById('btnVan').classList.add('bg-blue-600', 'text-white');
      }
    }

    function updateJarak() {
      const km = document.getElementById("jarakSelector").value;
      document.getElementById("jarak").value = km;
    }

    async function ambilJarak() {
      const asal = document.getElementById("alamatJemput").value;
      const tujuan = document.getElementById("alamatTujuan").value;

      // üõ†Ô∏è GANTI dengan API Key kamu dari Google Cloud Console
      const apiKey = "AIzaSyCiuyPP5eF6D7oce-Kyb6FzDPuaGHX7nUg";

      if (!asal || !tujuan) {
        alert("Isi alamat jemput dan tujuan dulu ya!");
        return;
      }

      const [withToll, withoutToll] = await Promise.all([
        fetch(`https://maps.googleapis.com/maps/api/directions/json?origin=${encodeURIComponent(asal)}&destination=${encodeURIComponent(tujuan)}&key=${apiKey}`)
          .then(res => res.json()),
        fetch(`https://maps.googleapis.com/maps/api/directions/json?origin=${encodeURIComponent(asal)}&destination=${encodeURIComponent(tujuan)}&avoid=tolls&key=${apiKey}`)
          .then(res => res.json()),
      ]);

      const select = document.getElementById("jarakSelector");
      select.innerHTML = "";

      if (withToll.routes.length > 0) {
        const km = withToll.routes[0].legs[0].distance.value / 1000;
        select.innerHTML += `<option value="${km.toFixed(1)}">Lewat TOL (${km.toFixed(1)} km)</option>`;
      }

      if (withoutToll.routes.length > 0) {
        const km = withoutToll.routes[0].legs[0].distance.value / 1000;
        select.innerHTML += `<option value="${km.toFixed(1)}">Tanpa TOL (${km.toFixed(1)} km)</option>`;
      }

      alert("‚úÖ Jarak berhasil diambil! Pilih rute yang ingin digunakan.");
    }

    function hitung() {
      const jarak = parseFloat(document.getElementById('jarak').value) || 0;
      const tol = parseFloat(document.getElementById('tol').value) || 0;
      const tujuan = parseInt(document.getElementById('tujuan').value) || 1;
      const pp = document.getElementById('pp').checked;
      const helper = document.getElementById('helper').checked;

      const tarif = {
        pickup: { tarifPerKm: 5500, konsumsi: 1 / 8, tetap: 60000 },
        van: { tarifPerKm: 6000, konsumsi: 1 / 10, tetap: 45000 },
      };

      const hargaBBM = 10500;
      const biayaHelper = helper ? 75000 : 0;
      const tambahanTujuan = (tujuan - 1) * 10000;

      const t = tarif[kendaraan];
      const biayaBBM = jarak * t.konsumsi * hargaBBM;
      const biayaJasa = (pp ? jarak * 2 : jarak) * t.tarifPerKm;
      const total = Math.round(biayaBBM + biayaJasa + t.tetap + tol + biayaHelper + tambahanTujuan);

      document.getElementById('hasil').innerHTML = `
        <p><strong>Biaya BBM:</strong> Rp${Math.round(biayaBBM).toLocaleString()}</p>
        <p><strong>Biaya Jasa:</strong> Rp${biayaJasa.toLocaleString()}</p>
        <p><strong>Biaya Tol:</strong> Rp${tol.toLocaleString()}</p>
        <p><strong>Biaya Helper:</strong> Rp${biayaHelper.toLocaleString()}</p>
        <p><strong>Multi Tujuan:</strong> Rp${tambahanTujuan.toLocaleString()}</p>
        <p><strong>Total Estimasi:</strong> <span class="text-green-600 font-bold">Rp${total.toLocaleString()}</span></p>
      `;

      document.getElementById('waText').value = `
üöö Estimasi Ongkir

üîπ Kendaraan: ${kendaraan === 'pickup' ? 'Pick Up' : 'Van'}
üîπ Jarak: ${jarak} km (PP ${pp ? '‚úÖ' : '‚ùå'})
üîπ BBM: Rp${Math.round(biayaBBM).toLocaleString()}
üîπ Jasa: Rp${biayaJasa.toLocaleString()}
üîπ Tol: Rp${tol.toLocaleString()}
üîπ Helper: ${helper ? '‚úÖ Ya (Rp75.000)' : '‚ùå Tidak'}
üîπ Tujuan: ${tujuan} titik

üí∞ Total Estimasi: Rp${total.toLocaleString()}
`.trim();
    }

    function salinWA() {
      const text = document.getElementById('waText').value;
      navigator.clipboard.writeText(text)
        .then(() => alert("‚úÖ Estimasi berhasil disalin! Tempelkan di WhatsApp."))
        .catch(() => alert("‚ùå Gagal menyalin teks."));
    }
  </script>
</body>
</html>
